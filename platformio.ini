; ============================================================================
; BioSimulator Pro - PlatformIO Configuration
; ============================================================================
; Version: 3.0.0
; Hardware: ESP32-WROOM-32
; ============================================================================

[platformio]
default_envs = esp32_wroom32

; ============================================================================
; ESP32-WROOM-32 (SIN PSRAM)
; ============================================================================
[env:esp32_wroom32]
platform = espressif32<
board = esp32dev
framework = arduino

; MCU Configuration
board_build.mcu = esp32
board_build.f_cpu = 240000000L

; Serial Monitor
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    colorize
    time

; Upload settings 
upload_port = COM4
upload_speed = 115200


; Build flags
build_flags = 
    ; Hardware identification
    -DBOARD_HAS_NO_PSRAM
    -DHARDWARE_MODEL=\"ESP32-WROOM-32\"
    
    ; Debug level (0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose)
    -DCORE_DEBUG_LEVEL=3
    -DDEBUG_ENABLED
    
    ; Optimization
    -O2
    -ffast-math
    
    ; FreeRTOS configuration
    -DARDUINO_LOOP_STACK_SIZE=8192
    -DCONFIG_FREERTOS_UNICORE=0
    
    ; Include paths for new structure
    -I include
    -I include/data
    -I include/models
    -I include/core
    -I include/comm

; Source files filter
build_src_filter = 
    +<*.cpp>
    +<models/*.cpp>
    +<core/*.cpp>
    +<comm/*.cpp>

; Library dependencies (if needed in future)
lib_deps = 

; ============================================================================
; Development environment with more debug
; ============================================================================
[env:esp32_dev]
extends = env:esp32_wroom32
build_flags = 
    ${env:esp32_wroom32.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_VERBOSE

; ============================================================================
; Debug ECG environment (sin Nextion, solo Serial Plotter)
; ============================================================================
[env:esp32_debug_ecg]
platform = espressif32
board = esp32dev
framework = arduino

board_build.mcu = esp32
board_build.f_cpu = 240000000L

monitor_speed = 115200
upload_port = COM4
upload_speed = 115200

build_flags = 
    -DBOARD_HAS_NO_PSRAM
    -DHARDWARE_MODEL=\"ESP32-WROOM-32\"
    -DCORE_DEBUG_LEVEL=3
    -DDEBUG_ENABLED
    -DDEBUG_MODE_ECG
    -O2
    -ffast-math
    -I include
    -I include/data
    -I include/models
    -I include/core
    -I include/comm

; Solo compilar main_debug.cpp y modelos (sin Nextion)
build_src_filter = 
    +<main_debug.cpp>
    +<models/ecg_model.cpp>
    +<models/emg_model.cpp>
    +<models/ppg_model.cpp>

; ============================================================================
; Release environment (optimized)
; ============================================================================
[env:esp32_release]
extends = env:esp32_wroom32
build_flags = 
    -DBOARD_HAS_NO_PSRAM
    -DHARDWARE_MODEL=\"ESP32-WROOM-32\"
    -DCORE_DEBUG_LEVEL=0
    -O3
    -ffast-math
    -funroll-loops
    -ftree-vectorize
    -DARDUINO_LOOP_STACK_SIZE=8192
    -DCONFIG_FREERTOS_UNICORE=0
    -I include
    -I include/data
    -I include/models
    -I include/core
    -I include/comm
