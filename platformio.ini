; ============================================================================
; BioSignalSimulator Pro - PlatformIO Configuration
; ============================================================================

; Version: 3.0.0
; Hardware: ESP32-WROOM-32
; ============================================================================

[platformio]
default_envs = esp32_wroom32

; ============================================================================
; ESP32-WROOM-32 (SIN PSRAM)
; ============================================================================
[env:esp32_wroom32]
platform = espressif32
board = esp32dev
framework = arduino

; MCU Configuration
board_build.mcu = esp32
board_build.f_cpu = 240000000L

; Serial Monitor
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    colorize
    time

; Upload settings 
upload_port = COM4
upload_speed = 115200


; Build flags
build_flags = 
    ; Hardware identification
    -DBOARD_HAS_NO_PSRAM
    -DHARDWARE_MODEL=\"ESP32-WROOM-32\"
    
    ; Debug level (0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose)
    -DCORE_DEBUG_LEVEL=3
    -DDEBUG_ENABLED
    
    ; Optimization
    -O2
    -ffast-math
    
    ; FreeRTOS configuration
    -DARDUINO_LOOP_STACK_SIZE=8192
    -DCONFIG_FREERTOS_UNICORE=0
    
    ; Include paths for new structure
    -I include
    -I include/data
    -I include/models
    -I include/core
    -I include/comm
    -I include/hw

; Source files filter - Excluir main_debug.cpp (usar entorno esp32_debug para eso)
build_src_filter = 
    +<main.cpp>
    +<models/*.cpp>
    +<core/*.cpp>
    +<comm/*.cpp>
    +<hw/*.cpp>

; Library dependencies
lib_deps =
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    bblanchon/ArduinoJson@^6.21.3

; SPIFFS filesystem for web files
board_build.filesystem = spiffs

; ============================================================================
; DEBUG environment - Serial Plotter (main_debug.cpp)
; Usar: pio run -e esp32_debug --target upload
; ============================================================================
[env:esp32_debug]
extends = env:esp32_wroom32
build_src_filter = 
    +<main_debug.cpp>
    +<models/*.cpp>
    +<core/*.cpp>
    +<comm/*.cpp>
    +<hw/*.cpp>
build_flags = 
    ${env:esp32_wroom32.build_flags}
    -DCORE_DEBUG_LEVEL=4
    -DDEBUG_MODE

; ============================================================================
; Development environment with more debug
; ============================================================================
[env:esp32_dev]
extends = env:esp32_wroom32
build_flags = 
    ${env:esp32_wroom32.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_VERBOSE

; ============================================================================
; Release environment (optimized)
; ============================================================================
[env:esp32_release]
extends = env:esp32_wroom32
build_flags = 
    -DBOARD_HAS_NO_PSRAM
    -DHARDWARE_MODEL=\"ESP32-WROOM-32\"
    -DCORE_DEBUG_LEVEL=0
    -O3
    -ffast-math
    -funroll-loops
    -ftree-vectorize
    -DARDUINO_LOOP_STACK_SIZE=8192
    -DCONFIG_FREERTOS_UNICORE=0
    -I include
    -I include/data
    -I include/models
    -I include/core
    -I include/comm
    -I include/hw

; ============================================================================
; ECG Model V2 Test environment
; Usar: pio run -e esp32_v2 --target upload
; ============================================================================
[env:esp32_v2]
extends = env:esp32_wroom32
build_src_filter = 
    +<main_debug_v2.cpp>
    +<models/ecg_model_v2.cpp>
build_flags = 
    ${env:esp32_wroom32.build_flags}
    -DCORE_DEBUG_LEVEL=3
    -DECG_MODEL_V2