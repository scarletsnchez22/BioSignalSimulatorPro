<svg xmlns="http://www.w3.org/2000/svg" width="595" height="842" viewBox="0 0 595 842">
  <rect width="100%" height="100%" fill="white"/>
  
  <!-- Título -->
  <text x="297" y="35" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold">ECG – Modelo dinámico</text>
  <text x="297" y="55" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">McSharry 2003</text>
  
  <!-- deltaTime -->
  <rect x="222" y="75" width="150" height="30" rx="5" fill="#d0d0d0" stroke="#333" stroke-width="1.5"/>
  <text x="297" y="95" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">deltaTime</text>
  
  <!-- Flecha -->
  <line x1="297" y1="105" x2="297" y2="120" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,125 293,118 301,118" fill="#333"/>
  
  <!-- generateSample -->
  <rect x="172" y="130" width="250" height="30" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="297" y="150" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold">generateSample(deltaTime)</text>
  
  <!-- Flecha -->
  <line x1="297" y1="160" x2="297" y2="175" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,180 293,173 301,173" fill="#333"/>
  
  <!-- Decision VFib -->
  <rect x="147" y="185" width="300" height="35" rx="3" fill="#fff3cd" stroke="#856404" stroke-width="1.5"/>
  <text x="297" y="207" text-anchor="middle" font-family="Arial" font-size="10">¿Condición = VENTRICULAR_FIBRILLATION?</text>
  
  <!-- Ramas SÍ/NO -->
  <text x="180" y="235" font-family="Arial" font-size="10" fill="#c00" font-weight="bold">SÍ</text>
  <text x="400" y="235" font-family="Arial" font-size="10" fill="#c00" font-weight="bold">NO</text>
  
  <line x1="220" y1="220" x2="180" y2="250" stroke="#333" stroke-width="1.5"/>
  <polygon points="180,255 176,246 184,248" fill="#333"/>
  
  <line x1="374" y1="220" x2="414" y2="250" stroke="#333" stroke-width="1.5"/>
  <polygon points="414,255 410,246 418,248" fill="#333"/>
  
  <!-- VFib box -->
  <rect x="100" y="260" width="160" height="40" rx="3" fill="#f9f9f9" stroke="#333" stroke-width="1.5"/>
  <text x="180" y="277" text-anchor="middle" font-family="Arial" font-size="9">generateVFibSample()</text>
  <text x="180" y="292" text-anchor="middle" font-family="Arial" font-size="8" fill="#666">(modelo espectral)</text>
  
  <!-- Omega box -->
  <rect x="334" y="260" width="160" height="35" rx="3" fill="#e0e0e0" stroke="#333" stroke-width="1.5"/>
  <text x="414" y="282" text-anchor="middle" font-family="Arial" font-size="10">ω = 2π / currentRR</text>
  
  <!-- Merge arrows -->
  <line x1="180" y1="300" x2="297" y2="330" stroke="#333" stroke-width="1.5"/>
  <line x1="414" y1="295" x2="297" y2="330" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,335 293,328 301,328" fill="#333"/>
  
  <!-- RK4 box -->
  <rect x="147" y="340" width="300" height="75" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="297" y="358" text-anchor="middle" font-family="Courier New" font-size="10" font-weight="bold">rungeKutta4Step(dt, ω)</text>
  <text x="297" y="378" text-anchor="middle" font-family="Courier New" font-size="9">dx/dt = αx − ωy</text>
  <text x="297" y="393" text-anchor="middle" font-family="Courier New" font-size="9">dy/dt = αy + ωx</text>
  <text x="297" y="408" text-anchor="middle" font-family="Courier New" font-size="8">dz/dt = −Σ aᵢ Δθᵢ exp(−Δθᵢ²/2bᵢ²) − (z − z₀)</text>
  
  <!-- Flecha -->
  <line x1="297" y1="415" x2="297" y2="430" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,435 293,428 301,428" fill="#333"/>
  
  <!-- Decision nuevo latido -->
  <rect x="172" y="440" width="250" height="30" rx="3" fill="#fff3cd" stroke="#856404" stroke-width="1.5"/>
  <text x="297" y="460" text-anchor="middle" font-family="Arial" font-size="10">¿Cruce θ = 0? (nuevo latido)</text>
  
  <text x="310" y="485" font-family="Arial" font-size="9" fill="#c00" font-weight="bold">SÍ</text>
  <line x1="297" y1="470" x2="297" y2="490" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,495 293,488 301,488" fill="#333"/>
  
  <!-- detectNewBeat -->
  <rect x="157" y="500" width="280" height="60" rx="3" fill="#f9f9f9" stroke="#333" stroke-width="1.5"/>
  <text x="297" y="517" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold">detectNewBeat()</text>
  <text x="297" y="532" text-anchor="middle" font-family="Arial" font-size="8">• Actualizar beatCount  • Generar nuevo RR (HRV)</text>
  <text x="297" y="547" text-anchor="middle" font-family="Arial" font-size="8">• Medir métricas PQRST  • Aplicar parámetros pending</text>
  
  <!-- Flecha -->
  <line x1="297" y1="560" x2="297" y2="575" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,580 293,573 301,573" fill="#333"/>
  
  <!-- Decision calibrated -->
  <rect x="182" y="585" width="230" height="28" rx="3" fill="#fff3cd" stroke="#856404" stroke-width="1.5"/>
  <text x="297" y="604" text-anchor="middle" font-family="Arial" font-size="10">¿isCalibrated = true?</text>
  
  <!-- Ramas -->
  <text x="160" y="630" font-family="Arial" font-size="9" fill="#c00" font-weight="bold">NO</text>
  <text x="420" y="630" font-family="Arial" font-size="9" fill="#c00" font-weight="bold">SÍ</text>
  
  <line x1="220" y1="613" x2="180" y2="640" stroke="#333" stroke-width="1.5"/>
  <line x1="374" y1="613" x2="414" y2="640" stroke="#333" stroke-width="1.5"/>
  
  <rect x="100" y="645" width="160" height="35" rx="3" fill="#f9f9f9" stroke="#333" stroke-width="1.5"/>
  <text x="180" y="660" text-anchor="middle" font-family="Arial" font-size="9">updateCalibrationBuffer()</text>
  <text x="180" y="673" text-anchor="middle" font-family="Arial" font-size="8" fill="#666">(3 latidos)</text>
  
  <rect x="334" y="645" width="160" height="35" rx="3" fill="#e0e0e0" stroke="#333" stroke-width="1.5"/>
  <text x="414" y="667" text-anchor="middle" font-family="Courier New" font-size="9">z_mV = (z−baseline)×G</text>
  
  <!-- Merge -->
  <line x1="180" y1="680" x2="297" y2="705" stroke="#333" stroke-width="1.5"/>
  <line x1="414" y1="680" x2="297" y2="705" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,710 293,703 301,703" fill="#333"/>
  
  <!-- Noise -->
  <rect x="182" y="715" width="230" height="25" rx="3" fill="#f9f9f9" stroke="#333" stroke-width="1.5"/>
  <text x="297" y="732" text-anchor="middle" font-family="Arial" font-size="10">z_mV += noise × gaussian()</text>
  
  <!-- Flecha -->
  <line x1="297" y1="740" x2="297" y2="755" stroke="#333" stroke-width="1.5"/>
  <polygon points="297,760 293,753 301,753" fill="#333"/>
  
  <!-- Output range -->
  <rect x="182" y="765" width="230" height="28" rx="3" fill="#d4edda" stroke="#155724" stroke-width="1.5"/>
  <text x="297" y="784" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold">Rango: −0.5 a +1.5 mV</text>
  
  <!-- Output boxes -->
  <line x1="230" y1="793" x2="170" y2="810" stroke="#333" stroke-width="1.5"/>
  <line x1="364" y1="793" x2="424" y2="810" stroke="#333" stroke-width="1.5"/>
  
</svg>
