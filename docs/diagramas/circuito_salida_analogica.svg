<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1300 900" width="1300" height="900">
  <defs>
    <!-- Gradientes -->
    <linearGradient id="gradDAC" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4299e1"/>
      <stop offset="100%" style="stop-color:#2b6cb0"/>
    </linearGradient>
    <linearGradient id="gradBuffer" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9f7aea"/>
      <stop offset="100%" style="stop-color:#805ad5"/>
    </linearGradient>
    <linearGradient id="gradMux" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ed8936"/>
      <stop offset="100%" style="stop-color:#dd6b20"/>
    </linearGradient>
    <linearGradient id="gradECG" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fc8181"/>
      <stop offset="100%" style="stop-color:#e53e3e"/>
    </linearGradient>
    <linearGradient id="gradEMG" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#68d391"/>
      <stop offset="100%" style="stop-color:#38a169"/>
    </linearGradient>
    <linearGradient id="gradPPG" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#63b3ed"/>
      <stop offset="100%" style="stop-color:#3182ce"/>
    </linearGradient>
    
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4a5568"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3182ce"/>
    </marker>
    
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.2"/>
    </filter>
    
    <!-- Patrón de señal escalonada (stepping) -->
    <pattern id="steppingPattern" patternUnits="userSpaceOnUse" width="60" height="30">
      <path d="M0,25 L10,25 L10,15 L20,15 L20,20 L30,20 L30,10 L40,10 L40,22 L50,22 L50,8 L60,8" stroke="#e53e3e" stroke-width="2" fill="none"/>
    </pattern>
    
    <!-- Patrón de señal suave -->
    <pattern id="smoothPattern" patternUnits="userSpaceOnUse" width="60" height="30">
      <path d="M0,20 Q15,10 30,20 T60,20" stroke="#38a169" stroke-width="2" fill="none"/>
    </pattern>
  </defs>
  
  <!-- Fondo -->
  <rect width="1300" height="900" fill="#f8fafc"/>
  
  <!-- Título principal -->
  <text x="650" y="40" font-family="Segoe UI, Arial" font-size="26" font-weight="bold" fill="#1a202c" text-anchor="middle">
    Circuito de Salida Analógica con Filtros RC Selectivos
  </text>
  <text x="650" y="68" font-family="Segoe UI, Arial" font-size="14" fill="#718096" text-anchor="middle">
    DAC → Buffer LM358 → Demux CD4051 → Filtros RC → Conectores BNC
  </text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- BLOQUE 1: ESP32 DAC -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 110)">
    <rect x="0" y="0" width="180" height="180" rx="12" fill="white" stroke="#3182ce" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="40" rx="12" fill="url(#gradDAC)"/>
    <rect x="0" y="28" width="180" height="12" fill="url(#gradDAC)"/>
    <text x="90" y="28" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">ESP32 DAC</text>
    
    <!-- Contenido -->
    <text x="15" y="65" font-family="Segoe UI, Arial" font-size="11" fill="#2d3748">GPIO25 (DAC1)</text>
    <text x="15" y="85" font-family="Consolas, monospace" font-size="10" fill="#4a5568">• Resolución: 8-bit</text>
    <text x="15" y="103" font-family="Consolas, monospace" font-size="10" fill="#4a5568">• Fs: 4000 Hz</text>
    <text x="15" y="121" font-family="Consolas, monospace" font-size="10" fill="#4a5568">• Rango: 0-3.3V</text>
    <text x="15" y="139" font-family="Consolas, monospace" font-size="10" fill="#4a5568">• Zout: ~1kΩ</text>
    
    <!-- Señal escalonada -->
    <rect x="15" y="150" width="150" height="22" rx="4" fill="#fed7d7" stroke="#e53e3e" stroke-width="1"/>
    <text x="90" y="165" font-family="Segoe UI, Arial" font-size="9" fill="#c53030" text-anchor="middle">⚠ Stepping 4kHz</text>
  </g>
  
  <!-- Señal de salida DAC (stepping) -->
  <g transform="translate(230, 170)">
    <rect x="0" y="0" width="80" height="50" rx="6" fill="#fff5f5" stroke="#e53e3e" stroke-width="1"/>
    <path d="M10,40 L15,40 L15,25 L25,25 L25,35 L35,35 L35,15 L45,15 L45,30 L55,30 L55,20 L65,20 L65,38 L70,38" stroke="#e53e3e" stroke-width="2" fill="none"/>
    <text x="40" y="12" font-family="Segoe UI, Arial" font-size="7" fill="#c53030" text-anchor="middle">Stepping</text>
  </g>
  
  <!-- Flecha DAC → Buffer -->
  <path d="M230,200 L320,200" stroke="#4a5568" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="275" y="190" font-family="Consolas, monospace" font-size="10" fill="#4a5568" text-anchor="middle">0-3.3V</text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- BLOQUE 2: BUFFER LM358 -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(330, 110)">
    <rect x="0" y="0" width="200" height="180" rx="12" fill="white" stroke="#805ad5" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="40" rx="12" fill="url(#gradBuffer)"/>
    <rect x="0" y="28" width="200" height="12" fill="url(#gradBuffer)"/>
    <text x="100" y="28" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Buffer LM358</text>
    
    <!-- Símbolo OpAmp -->
    <g transform="translate(100, 90)">
      <polygon points="0,-25 50,0 0,25" fill="none" stroke="#805ad5" stroke-width="2"/>
      <text x="-15" y="-10" font-family="Segoe UI, Arial" font-size="12" fill="#805ad5">+</text>
      <text x="-15" y="10" font-family="Segoe UI, Arial" font-size="12" fill="#805ad5">−</text>
      <line x1="50" y1="0" x2="50" y2="30" stroke="#805ad5" stroke-width="1.5"/>
      <line x1="50" y1="30" x2="-10" y2="30" stroke="#805ad5" stroke-width="1.5"/>
      <line x1="-10" y1="30" x2="-10" y2="15" stroke="#805ad5" stroke-width="1.5"/>
      <circle cx="-10" cy="10" r="3" fill="#805ad5"/>
    </g>
    
    <text x="100" y="145" font-family="Segoe UI, Arial" font-size="10" fill="#553c9a" text-anchor="middle">Seguidor de Voltaje</text>
    <text x="100" y="162" font-family="Consolas, monospace" font-size="10" fill="#553c9a" text-anchor="middle">Av = 1 (Unity-gain)</text>
    
    <!-- Especificaciones -->
    <rect x="10" y="45" width="80" height="32" rx="4" fill="#e9d8fd"/>
    <text x="50" y="58" font-family="Segoe UI, Arial" font-size="8" fill="#553c9a" text-anchor="middle">Vcc: 5V</text>
    <text x="50" y="72" font-family="Segoe UI, Arial" font-size="8" fill="#553c9a" text-anchor="middle">Zout: ~10Ω</text>
  </g>
  
  <!-- Flecha Buffer → MUX -->
  <path d="M540,200 L590,200" stroke="#4a5568" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="565" y="190" font-family="Consolas, monospace" font-size="9" fill="#4a5568" text-anchor="middle">Low-Z</text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- BLOQUE 3: DEMUX CD4051 -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(600, 90)">
    <rect x="0" y="0" width="200" height="220" rx="12" fill="white" stroke="#dd6b20" stroke-width="3" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="40" rx="12" fill="url(#gradMux)"/>
    <rect x="0" y="28" width="200" height="12" fill="url(#gradMux)"/>
    <text x="100" y="28" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">DEMUX CD4051</text>
    
    <!-- Símbolo MUX -->
    <rect x="60" y="55" width="80" height="100" rx="6" fill="#fef3c7" stroke="#d69e2e" stroke-width="2"/>
    <text x="100" y="75" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#744210" text-anchor="middle">CD4051</text>
    
    <!-- COM entrada -->
    <line x1="20" y1="105" x2="60" y2="105" stroke="#d69e2e" stroke-width="2"/>
    <text x="25" y="100" font-family="Consolas, monospace" font-size="9" fill="#744210">COM</text>
    
    <!-- Canales salida -->
    <line x1="140" y1="75" x2="180" y2="75" stroke="#e53e3e" stroke-width="2"/>
    <text x="155" y="70" font-family="Consolas, monospace" font-size="9" fill="#e53e3e">CH0</text>
    
    <line x1="140" y1="105" x2="180" y2="105" stroke="#38a169" stroke-width="2"/>
    <text x="155" y="100" font-family="Consolas, monospace" font-size="9" fill="#38a169">CH1</text>
    
    <line x1="140" y1="135" x2="180" y2="135" stroke="#3182ce" stroke-width="2"/>
    <text x="155" y="130" font-family="Consolas, monospace" font-size="9" fill="#3182ce">CH2</text>
    
    <!-- Control -->
    <rect x="20" y="165" width="160" height="45" rx="4" fill="#fef3c7"/>
    <text x="100" y="182" font-family="Segoe UI, Arial" font-size="9" fill="#744210" text-anchor="middle">Control desde ESP32:</text>
    <text x="100" y="200" font-family="Consolas, monospace" font-size="9" fill="#744210" text-anchor="middle">S0=GPIO32, S1=GPIO33</text>
  </g>
  
  <!-- Flechas MUX → Filtros -->
  <path d="M810,165 L870,120" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M810,195 L870,195" stroke="#38a169" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M810,225 L870,270" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- BLOQUE 4: FILTROS RC + BNC -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  
  <!-- FILTRO ECG -->
  <g transform="translate(880, 80)">
    <rect x="0" y="0" width="380" height="90" rx="10" fill="white" stroke="#e53e3e" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="100" height="90" rx="10" fill="url(#gradECG)"/>
    <rect x="88" y="0" width="12" height="90" fill="url(#gradECG)"/>
    <text x="50" y="35" font-family="Segoe UI, Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">ECG</text>
    <text x="50" y="55" font-family="Consolas, monospace" font-size="11" fill="white" text-anchor="middle">CH0</text>
    <text x="50" y="75" font-family="Segoe UI, Arial" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">S0=0, S1=0</text>
    
    <!-- Circuito RC -->
    <g transform="translate(115, 25)">
      <!-- Resistor -->
      <line x1="0" y1="20" x2="15" y2="20" stroke="#c53030" stroke-width="2"/>
      <path d="M15,20 L20,10 L30,30 L40,10 L50,30 L60,10 L70,30 L75,20" stroke="#c53030" stroke-width="2" fill="none"/>
      <line x1="75" y1="20" x2="100" y2="20" stroke="#c53030" stroke-width="2"/>
      <text x="45" y="50" font-family="Consolas, monospace" font-size="11" fill="#c53030" text-anchor="middle">6.8 kΩ</text>
      
      <!-- Capacitor -->
      <line x1="100" y1="20" x2="100" y2="35" stroke="#c53030" stroke-width="2"/>
      <line x1="90" y1="35" x2="110" y2="35" stroke="#c53030" stroke-width="2"/>
      <line x1="90" y1="42" x2="110" y2="42" stroke="#c53030" stroke-width="2"/>
      <line x1="100" y1="42" x2="100" y2="55" stroke="#c53030" stroke-width="2"/>
      <text x="125" y="42" font-family="Consolas, monospace" font-size="10" fill="#c53030">1µF</text>
      
      <!-- GND -->
      <line x1="95" y1="55" x2="105" y2="55" stroke="#c53030" stroke-width="2"/>
      <line x1="97" y1="58" x2="103" y2="58" stroke="#c53030" stroke-width="1.5"/>
      <line x1="99" y1="61" x2="101" y2="61" stroke="#c53030" stroke-width="1"/>
    </g>
    
    <!-- Fc y Atenuación -->
    <rect x="245" y="15" width="60" height="60" rx="6" fill="#fed7d7"/>
    <text x="275" y="35" font-family="Segoe UI, Arial" font-size="9" fill="#c53030" text-anchor="middle">Fc</text>
    <text x="275" y="52" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#c53030" text-anchor="middle">23.4Hz</text>
    <text x="275" y="68" font-family="Consolas, monospace" font-size="8" fill="#c53030" text-anchor="middle">-44dB@4k</text>
    
    <!-- BNC -->
    <circle cx="340" cy="45" r="25" fill="#c53030" stroke="#991b1b" stroke-width="2"/>
    <circle cx="340" cy="45" r="10" fill="#fef2f2"/>
    <text x="340" y="50" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#c53030" text-anchor="middle">BNC</text>
  </g>
  
  <!-- FILTRO EMG -->
  <g transform="translate(880, 180)">
    <rect x="0" y="0" width="380" height="90" rx="10" fill="white" stroke="#38a169" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="100" height="90" rx="10" fill="url(#gradEMG)"/>
    <rect x="88" y="0" width="12" height="90" fill="url(#gradEMG)"/>
    <text x="50" y="35" font-family="Segoe UI, Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">EMG</text>
    <text x="50" y="55" font-family="Consolas, monospace" font-size="11" fill="white" text-anchor="middle">CH1</text>
    <text x="50" y="75" font-family="Segoe UI, Arial" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">S0=1, S1=0</text>
    
    <!-- Circuito RC -->
    <g transform="translate(115, 25)">
      <line x1="0" y1="20" x2="15" y2="20" stroke="#276749" stroke-width="2"/>
      <path d="M15,20 L20,10 L30,30 L40,10 L50,30 L60,10 L70,30 L75,20" stroke="#276749" stroke-width="2" fill="none"/>
      <line x1="75" y1="20" x2="100" y2="20" stroke="#276749" stroke-width="2"/>
      <text x="45" y="50" font-family="Consolas, monospace" font-size="11" fill="#276749" text-anchor="middle">1.0 kΩ</text>
      
      <line x1="100" y1="20" x2="100" y2="35" stroke="#276749" stroke-width="2"/>
      <line x1="90" y1="35" x2="110" y2="35" stroke="#276749" stroke-width="2"/>
      <line x1="90" y1="42" x2="110" y2="42" stroke="#276749" stroke-width="2"/>
      <line x1="100" y1="42" x2="100" y2="55" stroke="#276749" stroke-width="2"/>
      <text x="125" y="42" font-family="Consolas, monospace" font-size="10" fill="#276749">1µF</text>
      
      <line x1="95" y1="55" x2="105" y2="55" stroke="#276749" stroke-width="2"/>
      <line x1="97" y1="58" x2="103" y2="58" stroke="#276749" stroke-width="1.5"/>
      <line x1="99" y1="61" x2="101" y2="61" stroke="#276749" stroke-width="1"/>
    </g>
    
    <rect x="245" y="15" width="60" height="60" rx="6" fill="#c6f6d5"/>
    <text x="275" y="35" font-family="Segoe UI, Arial" font-size="9" fill="#276749" text-anchor="middle">Fc</text>
    <text x="275" y="52" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#276749" text-anchor="middle">159Hz</text>
    <text x="275" y="68" font-family="Consolas, monospace" font-size="8" fill="#276749" text-anchor="middle">-28dB@4k</text>
    
    <circle cx="340" cy="45" r="25" fill="#38a169" stroke="#276749" stroke-width="2"/>
    <circle cx="340" cy="45" r="10" fill="#f0fff4"/>
    <text x="340" y="50" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#276749" text-anchor="middle">BNC</text>
  </g>
  
  <!-- FILTRO PPG -->
  <g transform="translate(880, 280)">
    <rect x="0" y="0" width="380" height="90" rx="10" fill="white" stroke="#3182ce" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="100" height="90" rx="10" fill="url(#gradPPG)"/>
    <rect x="88" y="0" width="12" height="90" fill="url(#gradPPG)"/>
    <text x="50" y="35" font-family="Segoe UI, Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">PPG</text>
    <text x="50" y="55" font-family="Consolas, monospace" font-size="11" fill="white" text-anchor="middle">CH2</text>
    <text x="50" y="75" font-family="Segoe UI, Arial" font-size="9" fill="rgba(255,255,255,0.9)" text-anchor="middle">S0=0, S1=1</text>
    
    <!-- Circuito RC -->
    <g transform="translate(115, 25)">
      <line x1="0" y1="20" x2="15" y2="20" stroke="#2b6cb0" stroke-width="2"/>
      <path d="M15,20 L20,10 L30,30 L40,10 L50,30 L60,10 L70,30 L75,20" stroke="#2b6cb0" stroke-width="2" fill="none"/>
      <line x1="75" y1="20" x2="100" y2="20" stroke="#2b6cb0" stroke-width="2"/>
      <text x="45" y="50" font-family="Consolas, monospace" font-size="11" fill="#2b6cb0" text-anchor="middle">33 kΩ</text>
      
      <line x1="100" y1="20" x2="100" y2="35" stroke="#2b6cb0" stroke-width="2"/>
      <line x1="90" y1="35" x2="110" y2="35" stroke="#2b6cb0" stroke-width="2"/>
      <line x1="90" y1="42" x2="110" y2="42" stroke="#2b6cb0" stroke-width="2"/>
      <line x1="100" y1="42" x2="100" y2="55" stroke="#2b6cb0" stroke-width="2"/>
      <text x="125" y="42" font-family="Consolas, monospace" font-size="10" fill="#2b6cb0">1µF</text>
      
      <line x1="95" y1="55" x2="105" y2="55" stroke="#2b6cb0" stroke-width="2"/>
      <line x1="97" y1="58" x2="103" y2="58" stroke="#2b6cb0" stroke-width="1.5"/>
      <line x1="99" y1="61" x2="101" y2="61" stroke="#2b6cb0" stroke-width="1"/>
    </g>
    
    <rect x="245" y="15" width="60" height="60" rx="6" fill="#bee3f8"/>
    <text x="275" y="35" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0" text-anchor="middle">Fc</text>
    <text x="275" y="52" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#2b6cb0" text-anchor="middle">4.8Hz</text>
    <text x="275" y="68" font-family="Consolas, monospace" font-size="8" fill="#2b6cb0" text-anchor="middle">-58dB@4k</text>
    
    <circle cx="340" cy="45" r="25" fill="#3182ce" stroke="#2b6cb0" stroke-width="2"/>
    <circle cx="340" cy="45" r="10" fill="#ebf8ff"/>
    <text x="340" y="50" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#2b6cb0" text-anchor="middle">BNC</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN INFERIOR: ANÁLISIS ESPECTRAL Y FÓRMULAS -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  
  <!-- Panel de fórmulas -->
  <rect x="40" y="400" width="400" height="240" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="400" width="400" height="35" rx="12" fill="#4a5568"/>
  <rect x="40" y="423" width="400" height="12" fill="#4a5568"/>
  <text x="240" y="425" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    Fórmulas de Diseño
  </text>
  
  <!-- Fórmula Fc -->
  <rect x="60" y="450" width="360" height="55" rx="8" fill="#edf2f7"/>
  <text x="80" y="475" font-family="Segoe UI, Arial" font-size="12" fill="#2d3748">Frecuencia de corte:</text>
  <text x="240" y="495" font-family="Cambria Math, serif" font-size="18" fill="#2d3748" text-anchor="middle">
    Fc = 1 / (2π × R × C)
  </text>
  
  <!-- Fórmula R -->
  <rect x="60" y="515" width="360" height="55" rx="8" fill="#edf2f7"/>
  <text x="80" y="540" font-family="Segoe UI, Arial" font-size="12" fill="#2d3748">Resistencia para Fc deseada:</text>
  <text x="240" y="560" font-family="Cambria Math, serif" font-size="18" fill="#2d3748" text-anchor="middle">
    R = 1 / (2π × Fc × C)
  </text>
  
  <!-- Fórmula Atenuación -->
  <rect x="60" y="580" width="360" height="50" rx="8" fill="#edf2f7"/>
  <text x="80" y="600" font-family="Segoe UI, Arial" font-size="12" fill="#2d3748">Atenuación a frecuencia f:</text>
  <text x="240" y="620" font-family="Cambria Math, serif" font-size="16" fill="#2d3748" text-anchor="middle">
    A(f) = 20 log₁₀(1 / √(1 + (f/Fc)²))
  </text>
  
  <!-- Panel de resultados FFT -->
  <rect x="460" y="400" width="400" height="240" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="460" y="400" width="400" height="35" rx="12" fill="#38a169"/>
  <rect x="460" y="423" width="400" height="12" fill="#38a169"/>
  <text x="660" y="425" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    Resultados Análisis FFT (model_fft_analysis.py)
  </text>
  
  <!-- Tabla resultados -->
  <text x="490" y="465" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#2d3748">Señal</text>
  <text x="550" y="465" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#2d3748">Fs modelo</text>
  <text x="630" y="465" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#2d3748">F 99%</text>
  <text x="700" y="465" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#2d3748">BW -20dB</text>
  <text x="780" y="465" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#2d3748">Banda clínica</text>
  <line x1="480" y1="475" x2="840" y2="475" stroke="#cbd5e0" stroke-width="1"/>
  
  <rect x="480" y="482" width="8" height="8" fill="#e53e3e" rx="2"/>
  <text x="495" y="490" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">ECG</text>
  <text x="550" y="490" font-family="Consolas, monospace" font-size="10" fill="#4a5568">300 Hz</text>
  <text x="630" y="490" font-family="Consolas, monospace" font-size="10" fill="#4a5568">21.6 Hz</text>
  <text x="700" y="490" font-family="Consolas, monospace" font-size="10" fill="#4a5568">24.0 Hz</text>
  <text x="780" y="490" font-family="Consolas, monospace" font-size="10" fill="#38a169">100% ✓</text>
  
  <rect x="480" y="502" width="8" height="8" fill="#38a169" rx="2"/>
  <text x="495" y="510" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">EMG</text>
  <text x="550" y="510" font-family="Consolas, monospace" font-size="10" fill="#4a5568">1000 Hz</text>
  <text x="630" y="510" font-family="Consolas, monospace" font-size="10" fill="#4a5568">146.3 Hz</text>
  <text x="700" y="510" font-family="Consolas, monospace" font-size="10" fill="#4a5568">158.0 Hz</text>
  <text x="780" y="510" font-family="Consolas, monospace" font-size="10" fill="#38a169">99.7% ✓</text>
  
  <rect x="480" y="522" width="8" height="8" fill="#3182ce" rx="2"/>
  <text x="495" y="530" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">PPG</text>
  <text x="550" y="530" font-family="Consolas, monospace" font-size="10" fill="#4a5568">100 Hz</text>
  <text x="630" y="530" font-family="Consolas, monospace" font-size="10" fill="#4a5568">4.9 Hz</text>
  <text x="700" y="530" font-family="Consolas, monospace" font-size="10" fill="#4a5568">4.9 Hz</text>
  <text x="780" y="530" font-family="Consolas, monospace" font-size="10" fill="#38a169">99.9% ✓</text>
  
  <!-- Criterio de diseño -->
  <rect x="480" y="550" width="360" height="80" rx="8" fill="#c6f6d5" stroke="#38a169" stroke-width="1"/>
  <text x="660" y="575" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#276749" text-anchor="middle">
    Criterio de Diseño del Filtro RC
  </text>
  <text x="660" y="600" font-family="Consolas, monospace" font-size="12" fill="#276749" text-anchor="middle">
    F_99% &lt; Fc_filtro &lt; Fs_DAC / 2
  </text>
  <text x="660" y="620" font-family="Segoe UI, Arial" font-size="10" fill="#276749" text-anchor="middle">
    Preservar 99% energía + Atenuar stepping 4kHz
  </text>
  
  <!-- Panel de señal antes/después -->
  <rect x="880" y="400" width="380" height="240" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="880" y="400" width="380" height="35" rx="12" fill="#805ad5"/>
  <rect x="880" y="423" width="380" height="12" fill="#805ad5"/>
  <text x="1070" y="425" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    Efecto del Filtrado RC
  </text>
  
  <!-- Señal ANTES -->
  <g transform="translate(900, 450)">
    <rect x="0" y="0" width="160" height="80" rx="6" fill="#fff5f5" stroke="#e53e3e" stroke-width="1"/>
    <text x="80" y="18" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#c53030" text-anchor="middle">ANTES (DAC)</text>
    <path d="M15,60 L25,60 L25,45 L35,45 L35,55 L45,55 L45,35 L55,35 L55,50 L65,50 L65,30 L75,30 L75,55 L85,55 L85,40 L95,40 L95,50 L105,50 L105,35 L115,35 L115,55 L125,55 L125,45 L135,45 L135,60 L145,60" stroke="#e53e3e" stroke-width="2" fill="none"/>
    <text x="80" y="75" font-family="Consolas, monospace" font-size="8" fill="#c53030" text-anchor="middle">Stepping visible</text>
  </g>
  
  <!-- Flecha -->
  <path d="M1080,490 L1080,510" stroke="#805ad5" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="1095" y="505" font-family="Segoe UI, Arial" font-size="9" fill="#805ad5">Filtro RC</text>
  
  <!-- Señal DESPUÉS -->
  <g transform="translate(900, 530)">
    <rect x="0" y="0" width="160" height="80" rx="6" fill="#f0fff4" stroke="#38a169" stroke-width="1"/>
    <text x="80" y="18" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">DESPUÉS (BNC)</text>
    <path d="M15,55 Q30,35 45,50 T75,48 T105,52 T135,45 L145,50" stroke="#38a169" stroke-width="2" fill="none"/>
    <text x="80" y="75" font-family="Consolas, monospace" font-size="8" fill="#276749" text-anchor="middle">Señal suave</text>
  </g>
  
  <!-- Atenuación summary -->
  <g transform="translate(1080, 455)">
    <rect x="0" y="0" width="160" height="150" rx="8" fill="#e9d8fd" stroke="#805ad5" stroke-width="1"/>
    <text x="80" y="22" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#553c9a" text-anchor="middle">Atenuación @4kHz</text>
    <line x1="10" y1="32" x2="150" y2="32" stroke="#805ad5" stroke-width="1"/>
    
    <circle cx="25" cy="52" r="8" fill="#e53e3e"/>
    <text x="45" y="56" font-family="Segoe UI, Arial" font-size="10" fill="#553c9a">ECG: -44 dB</text>
    <text x="100" y="70" font-family="Consolas, monospace" font-size="9" fill="#718096">(158×)</text>
    
    <circle cx="25" cy="92" r="8" fill="#38a169"/>
    <text x="45" y="96" font-family="Segoe UI, Arial" font-size="10" fill="#553c9a">EMG: -28 dB</text>
    <text x="100" y="110" font-family="Consolas, monospace" font-size="9" fill="#718096">(25×)</text>
    
    <circle cx="25" cy="132" r="8" fill="#3182ce"/>
    <text x="45" y="136" font-family="Segoe UI, Arial" font-size="10" fill="#553c9a">PPG: -58 dB</text>
    <text x="100" y="150" font-family="Consolas, monospace" font-size="9" fill="#718096">(800×)</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN BUFFER SEGUIDOR - DETALLE -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="40" y="660" width="600" height="220" rx="12" fill="white" stroke="#805ad5" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="660" width="600" height="35" rx="12" fill="#805ad5"/>
  <rect x="40" y="683" width="600" height="12" fill="#805ad5"/>
  <text x="340" y="685" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    Detalle: Buffer Seguidor LM358
  </text>
  
  <!-- ¿Por qué buffer? -->
  <g transform="translate(60, 710)">
    <text x="0" y="0" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#2d3748">¿Por qué es necesario el buffer?</text>
    
    <rect x="0" y="15" width="260" height="75" rx="6" fill="#fed7d7"/>
    <text x="130" y="35" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#c53030" text-anchor="middle">SIN BUFFER</text>
    <text x="15" y="55" font-family="Segoe UI, Arial" font-size="9" fill="#c53030">• DAC Zout ≈ 1 kΩ (alta impedancia)</text>
    <text x="15" y="72" font-family="Segoe UI, Arial" font-size="9" fill="#c53030">• Carga de filtros distorsiona señal</text>
    <text x="15" y="89" font-family="Segoe UI, Arial" font-size="9" fill="#c53030">• División de voltaje no deseada</text>
    
    <rect x="0" y="100" width="260" height="75" rx="6" fill="#c6f6d5"/>
    <text x="130" y="120" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">CON BUFFER LM358</text>
    <text x="15" y="140" font-family="Segoe UI, Arial" font-size="9" fill="#276749">• Zin muy alta (no carga el DAC)</text>
    <text x="15" y="157" font-family="Segoe UI, Arial" font-size="9" fill="#276749">• Zout baja (~10Ω) → puede manejar cargas</text>
    <text x="15" y="174" font-family="Segoe UI, Arial" font-size="9" fill="#276749">• Ganancia = 1 (no altera amplitud)</text>
  </g>
  
  <!-- Circuito del buffer -->
  <g transform="translate(360, 710)">
    <text x="0" y="0" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#2d3748">Configuración Unity-Gain</text>
    
    <rect x="0" y="15" width="260" height="150" rx="6" fill="#f7fafc"/>
    
    <!-- OpAmp símbolo grande -->
    <polygon points="50,70 150,110 50,150" fill="none" stroke="#805ad5" stroke-width="3"/>
    <text x="35" y="95" font-family="Segoe UI, Arial" font-size="14" fill="#805ad5">+</text>
    <text x="35" y="130" font-family="Segoe UI, Arial" font-size="14" fill="#805ad5">−</text>
    
    <!-- Entrada -->
    <line x1="10" y1="90" x2="50" y2="90" stroke="#3182ce" stroke-width="2"/>
    <text x="10" y="82" font-family="Consolas, monospace" font-size="9" fill="#3182ce">DAC</text>
    
    <!-- Realimentación -->
    <line x1="150" y1="110" x2="180" y2="110" stroke="#805ad5" stroke-width="2"/>
    <line x1="180" y1="110" x2="180" y2="160" stroke="#805ad5" stroke-width="2"/>
    <line x1="180" y1="160" x2="30" y2="160" stroke="#805ad5" stroke-width="2"/>
    <line x1="30" y1="160" x2="30" y2="125" stroke="#805ad5" stroke-width="2"/>
    <line x1="30" y1="125" x2="50" y2="125" stroke="#805ad5" stroke-width="2"/>
    
    <!-- Salida -->
    <line x1="180" y1="110" x2="240" y2="110" stroke="#38a169" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="210" y="100" font-family="Consolas, monospace" font-size="9" fill="#38a169">OUT</text>
    
    <!-- Alimentación -->
    <line x1="100" y1="70" x2="100" y2="55" stroke="#e53e3e" stroke-width="1.5"/>
    <text x="110" y="55" font-family="Consolas, monospace" font-size="8" fill="#e53e3e">+5V</text>
    <line x1="100" y1="150" x2="100" y2="165" stroke="#4a5568" stroke-width="1.5"/>
    <text x="110" y="165" font-family="Consolas, monospace" font-size="8" fill="#4a5568">GND</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN CD4051 DEMUX - DETALLE -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="660" y="660" width="600" height="220" rx="12" fill="white" stroke="#dd6b20" stroke-width="2" filter="url(#shadow)"/>
  <rect x="660" y="660" width="600" height="35" rx="12" fill="#dd6b20"/>
  <rect x="660" y="683" width="600" height="12" fill="#dd6b20"/>
  <text x="960" y="685" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    Detalle: Demultiplexor CD4051
  </text>
  
  <!-- Tabla de selección -->
  <g transform="translate(680, 710)">
    <text x="0" y="0" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#2d3748">Tabla de Selección de Canal</text>
    
    <rect x="0" y="15" width="220" height="155" rx="6" fill="#fef3c7" stroke="#d69e2e" stroke-width="1"/>
    
    <text x="30" y="40" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210">S1</text>
    <text x="70" y="40" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210">S0</text>
    <text x="115" y="40" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210">Canal</text>
    <text x="175" y="40" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210">Señal</text>
    <line x1="10" y1="50" x2="210" y2="50" stroke="#d69e2e" stroke-width="1"/>
    
    <text x="30" y="72" font-family="Consolas, monospace" font-size="11" fill="#744210">0</text>
    <text x="70" y="72" font-family="Consolas, monospace" font-size="11" fill="#744210">0</text>
    <text x="115" y="72" font-family="Consolas, monospace" font-size="11" fill="#744210">CH0</text>
    <rect x="165" y="60" width="40" height="18" rx="3" fill="#e53e3e"/>
    <text x="185" y="73" font-family="Segoe UI, Arial" font-size="9" fill="white" text-anchor="middle">ECG</text>
    
    <text x="30" y="102" font-family="Consolas, monospace" font-size="11" fill="#744210">0</text>
    <text x="70" y="102" font-family="Consolas, monospace" font-size="11" fill="#744210">1</text>
    <text x="115" y="102" font-family="Consolas, monospace" font-size="11" fill="#744210">CH1</text>
    <rect x="165" y="90" width="40" height="18" rx="3" fill="#38a169"/>
    <text x="185" y="103" font-family="Segoe UI, Arial" font-size="9" fill="white" text-anchor="middle">EMG</text>
    
    <text x="30" y="132" font-family="Consolas, monospace" font-size="11" fill="#744210">1</text>
    <text x="70" y="132" font-family="Consolas, monospace" font-size="11" fill="#744210">0</text>
    <text x="115" y="132" font-family="Consolas, monospace" font-size="11" fill="#744210">CH2</text>
    <rect x="165" y="120" width="40" height="18" rx="3" fill="#3182ce"/>
    <text x="185" y="133" font-family="Segoe UI, Arial" font-size="9" fill="white" text-anchor="middle">PPG</text>
    
    <text x="110" y="160" font-family="Segoe UI, Arial" font-size="9" fill="#744210" text-anchor="middle">S2 = GND (siempre 0)</text>
  </g>
  
  <!-- Ventajas arquitectura -->
  <g transform="translate(920, 710)">
    <text x="0" y="0" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#2d3748">Ventajas de la Arquitectura DEMUX</text>
    
    <rect x="0" y="15" width="320" height="155" rx="6" fill="#f0fff4" stroke="#38a169" stroke-width="1"/>
    
    <text x="15" y="40" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Solo 1 CD4051 necesario</text>
    <text x="15" y="60" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ 3 salidas BNC independientes</text>
    <text x="15" y="80" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Cada filtro completamente aislado</text>
    <text x="15" y="100" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Sin interferencia entre canales</text>
    <text x="15" y="120" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Solo el canal activo recibe señal DAC</text>
    <text x="15" y="140" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Filtro óptimo para cada tipo de señal</text>
    <text x="15" y="160" font-family="Segoe UI, Arial" font-size="10" fill="#276749">✓ Control simple: 2 GPIOs (S0, S1)</text>
  </g>
</svg>
