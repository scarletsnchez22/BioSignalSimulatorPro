<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 1100" width="1100" height="1100">
  <defs>
    <!-- Gradientes -->
    <linearGradient id="gradBateria" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fbd38d"/>
      <stop offset="100%" style="stop-color:#ed8936"/>
    </linearGradient>
    <linearGradient id="gradBMS" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#68d391"/>
      <stop offset="100%" style="stop-color:#38a169"/>
    </linearGradient>
    <linearGradient id="gradBoost" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#63b3ed"/>
      <stop offset="100%" style="stop-color:#3182ce"/>
    </linearGradient>
    <linearGradient id="gradCarga" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fc8181"/>
      <stop offset="100%" style="stop-color:#e53e3e"/>
    </linearGradient>
    
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#4a5568"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e53e3e"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#38a169"/>
    </marker>
    
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.2"/>
    </filter>
    
    <!-- Patrón de batería -->
    <pattern id="batteryStripe" patternUnits="userSpaceOnUse" width="8" height="8">
      <path d="M-2,2 l4,-4 M0,8 l8,-8 M6,10 l4,-4" stroke="#d69e2e" stroke-width="1.5" opacity="0.3"/>
    </pattern>
  </defs>
  
  <!-- Fondo -->
  <rect width="1100" height="750" fill="#f8fafc"/>
  
  <!-- Título principal -->
  <text x="550" y="40" font-family="Segoe UI, Arial" font-size="26" font-weight="bold" fill="#1a202c" text-anchor="middle">
    Selección del Sistema de Alimentación
  </text>
  <text x="550" y="65" font-family="Segoe UI, Arial" font-size="14" fill="#718096" text-anchor="middle">
    Análisis de requerimientos y selección de componentes - BioSignalSimulator Pro
  </text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN SUPERIOR: ANÁLISIS DE CONSUMO -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="40" y="90" width="480" height="220" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="90" width="480" height="35" rx="12" fill="#4a5568"/>
  <rect x="40" y="113" width="480" height="12" fill="#4a5568"/>
  <text x="280" y="115" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    ANÁLISIS DE CONSUMO DEL SISTEMA
  </text>
  
  <!-- Tabla de consumo -->
  <text x="60" y="155" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">Componente</text>
  <text x="220" y="155" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">Corriente típica</text>
  <text x="340" y="155" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">Corriente máx.</text>
  <text x="450" y="155" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">Voltaje</text>
  <line x1="50" y1="165" x2="510" y2="165" stroke="#e2e8f0" stroke-width="1"/>
  
  <!-- Filas -->
  <text x="60" y="185" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">ESP32-WROOM-32 (WiFi activo)</text>
  <text x="220" y="185" font-family="Consolas, monospace" font-size="10" fill="#4a5568">150 mA</text>
  <text x="340" y="185" font-family="Consolas, monospace" font-size="10" fill="#4a5568">240 mA</text>
  <text x="450" y="185" font-family="Consolas, monospace" font-size="10" fill="#4a5568">3.3V</text>
  
  <text x="60" y="205" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">Nextion NX8048T070 (7")</text>
  <text x="220" y="205" font-family="Consolas, monospace" font-size="10" fill="#4a5568">400 mA</text>
  <text x="340" y="205" font-family="Consolas, monospace" font-size="10" fill="#4a5568">510 mA</text>
  <text x="450" y="205" font-family="Consolas, monospace" font-size="10" fill="#4a5568">5V</text>
  
  <text x="60" y="225" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">LM358 (buffer)</text>
  <text x="220" y="225" font-family="Consolas, monospace" font-size="10" fill="#4a5568">1 mA</text>
  <text x="340" y="225" font-family="Consolas, monospace" font-size="10" fill="#4a5568">3 mA</text>
  <text x="450" y="225" font-family="Consolas, monospace" font-size="10" fill="#4a5568">5V</text>
  
  <text x="60" y="245" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">CD4051 (demux)</text>
  <text x="220" y="245" font-family="Consolas, monospace" font-size="10" fill="#4a5568">0.5 mA</text>
  <text x="340" y="245" font-family="Consolas, monospace" font-size="10" fill="#4a5568">1 mA</text>
  <text x="450" y="245" font-family="Consolas, monospace" font-size="10" fill="#4a5568">5V</text>
  
  <text x="60" y="265" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">LED RGB</text>
  <text x="220" y="265" font-family="Consolas, monospace" font-size="10" fill="#4a5568">15 mA</text>
  <text x="340" y="265" font-family="Consolas, monospace" font-size="10" fill="#4a5568">60 mA</text>
  <text x="450" y="265" font-family="Consolas, monospace" font-size="10" fill="#4a5568">3.3V</text>
  
  <line x1="50" y1="275" x2="510" y2="275" stroke="#2d3748" stroke-width="2"/>
  <text x="60" y="295" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">TOTAL (referido a 5V)</text>
  <text x="220" y="295" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#e53e3e">≈ 620 mA</text>
  <text x="340" y="295" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#e53e3e">≈ 870 mA</text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN SUPERIOR DERECHA: CÁLCULO DE AUTONOMÍA -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="540" y="90" width="520" height="220" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="540" y="90" width="520" height="35" rx="12" fill="#38a169"/>
  <rect x="540" y="113" width="520" height="12" fill="#38a169"/>
  <text x="800" y="115" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    CÁLCULO DE AUTONOMÍA
  </text>
  
  <!-- Fórmulas y cálculo -->
  <text x="560" y="150" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#276749">Requisito: ≥ 3 horas de operación continua</text>
  
  <rect x="560" y="165" width="480" height="60" rx="8" fill="#f0fff4" stroke="#38a169" stroke-width="1"/>
  <text x="580" y="188" font-family="Segoe UI, Arial" font-size="11" fill="#276749">Capacidad requerida:</text>
  <text x="580" y="210" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#276749">C = I × t = 620 mA × 3 h = 1860 mAh (mínimo)</text>
  
  <text x="560" y="250" font-family="Segoe UI, Arial" font-size="11" fill="#4a5568">Considerando eficiencia del boost (η ≈ 85%) y margen de seguridad (×1.3):</text>
  
  <rect x="560" y="260" width="480" height="40" rx="8" fill="#fef3c7" stroke="#d69e2e" stroke-width="1"/>
  <text x="580" y="285" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#744210">C_real = 1860 / 0.85 × 1.3 ≈ 2844 mAh → Usar 5200 mAh</text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN MEDIA: SELECCIÓN DE BATERÍA -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="40" y="330" width="500" height="200" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="40" y="330" width="500" height="35" rx="12" fill="url(#gradBateria)"/>
  <rect x="40" y="353" width="500" height="12" fill="url(#gradBateria)"/>
  <text x="290" y="355" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="#744210" text-anchor="middle">
    SELECCIÓN DE BATERÍA: 2× Li-ion 18650
  </text>
  
  <!-- Ilustración batería 18650 -->
  <g transform="translate(60, 380)">
    <rect x="0" y="10" width="80" height="35" rx="5" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
    <rect x="0" y="10" width="80" height="35" rx="5" fill="url(#batteryStripe)"/>
    <rect x="80" y="18" width="8" height="20" rx="2" fill="#38a169"/>
    <text x="40" y="33" font-family="Consolas, monospace" font-size="9" fill="#276749" text-anchor="middle">18650</text>
    
    <rect x="0" y="55" width="80" height="35" rx="5" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
    <rect x="0" y="55" width="80" height="35" rx="5" fill="url(#batteryStripe)"/>
    <rect x="80" y="63" width="8" height="20" rx="2" fill="#38a169"/>
    <text x="40" y="78" font-family="Consolas, monospace" font-size="9" fill="#276749" text-anchor="middle">18650</text>
    
    <!-- Conexión paralelo -->
    <line x1="95" y1="28" x2="110" y2="28" stroke="#38a169" stroke-width="2"/>
    <line x1="95" y1="73" x2="110" y2="73" stroke="#38a169" stroke-width="2"/>
    <line x1="110" y1="28" x2="110" y2="73" stroke="#38a169" stroke-width="2"/>
    <line x1="110" y1="50" x2="130" y2="50" stroke="#38a169" stroke-width="3" marker-end="url(#arrowGreen)"/>
    <text x="55" y="110" font-family="Segoe UI, Arial" font-size="10" fill="#276749" text-anchor="middle">Paralelo (1S2P)</text>
  </g>
  
  <!-- Especificaciones -->
  <g transform="translate(210, 385)">
    <text x="0" y="0" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#2d3748">Especificaciones por celda:</text>
    <text x="0" y="20" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">• Voltaje nominal: 3.7V</text>
    <text x="0" y="38" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">• Capacidad: 2600 mAh</text>
    <text x="0" y="56" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">• Voltaje carga máx: 4.2V</text>
    <text x="0" y="74" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">• Voltaje descarga mín: 2.5V</text>
    <text x="0" y="92" font-family="Segoe UI, Arial" font-size="10" fill="#4a5568">• Corriente descarga máx: 5A</text>
  </g>
  
  <!-- Resultado configuración -->
  <g transform="translate(380, 385)">
    <rect x="0" y="0" width="140" height="110" rx="8" fill="#fef3c7" stroke="#d69e2e" stroke-width="2"/>
    <text x="70" y="22" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="#744210" text-anchor="middle">CONFIGURACIÓN</text>
    <line x1="10" y1="32" x2="130" y2="32" stroke="#d69e2e" stroke-width="1"/>
    <text x="70" y="52" font-family="Segoe UI, Arial" font-size="10" fill="#744210" text-anchor="middle">1S2P (paralelo)</text>
    <text x="70" y="72" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#744210" text-anchor="middle">3.7V @ 5200mAh</text>
    <text x="70" y="95" font-family="Segoe UI, Arial" font-size="10" fill="#744210" text-anchor="middle">≈ 19.24 Wh</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN MEDIA DERECHA: MÓDULOS DE GESTIÓN -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="560" y="330" width="500" height="200" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <rect x="560" y="330" width="500" height="35" rx="12" fill="url(#gradBMS)"/>
  <rect x="560" y="353" width="500" height="12" fill="url(#gradBMS)"/>
  <text x="810" y="355" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="white" text-anchor="middle">
    MÓDULOS DE GESTIÓN DE ENERGÍA
  </text>
  
  <!-- IP5306 -->
  <g transform="translate(580, 380)">
    <rect x="0" y="0" width="200" height="130" rx="8" fill="#e6fffa" stroke="#38b2ac" stroke-width="2"/>
    <rect x="0" y="0" width="200" height="28" rx="8" fill="#38b2ac"/>
    <rect x="0" y="16" width="200" height="12" fill="#38b2ac"/>
    <text x="100" y="20" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="white" text-anchor="middle">IP5306 - BMS + Carga</text>
    
    <text x="15" y="50" font-family="Segoe UI, Arial" font-size="9" fill="#234e52">✓ Carga USB-C 5V 2A</text>
    <text x="15" y="68" font-family="Segoe UI, Arial" font-size="9" fill="#234e52">✓ Protección sobrecarga (4.2V)</text>
    <text x="15" y="86" font-family="Segoe UI, Arial" font-size="9" fill="#234e52">✓ Protección sobredescarga</text>
    <text x="15" y="104" font-family="Segoe UI, Arial" font-size="9" fill="#234e52">✓ Balance de celdas (1S)</text>
    <text x="15" y="122" font-family="Segoe UI, Arial" font-size="9" fill="#234e52">✓ LEDs indicadores (4 niveles)</text>
  </g>
  
  <!-- XL6009 -->
  <g transform="translate(800, 380)">
    <rect x="0" y="0" width="240" height="130" rx="8" fill="#ebf8ff" stroke="#3182ce" stroke-width="2"/>
    <rect x="0" y="0" width="240" height="28" rx="8" fill="#3182ce"/>
    <rect x="0" y="16" width="240" height="12" fill="#3182ce"/>
    <text x="120" y="20" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="white" text-anchor="middle">XL6009 - Boost Converter</text>
    
    <text x="15" y="50" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0">✓ Entrada: 3.0V - 32V</text>
    <text x="15" y="68" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0">✓ Salida: 5V - 35V (ajustable)</text>
    <text x="15" y="86" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0">✓ Corriente máxima: 3A</text>
    <text x="15" y="104" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0">✓ Eficiencia: 85-94%</text>
    <text x="15" y="122" font-family="Segoe UI, Arial" font-size="9" fill="#2b6cb0">✓ Frecuencia switching: 400kHz</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN INFERIOR: DIAGRAMA DE FLUJO DE ENERGÍA -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="40" y="550" width="1020" height="180" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <text x="550" y="580" font-family="Segoe UI, Arial" font-size="14" font-weight="bold" fill="#2d3748" text-anchor="middle">
    Flujo de Energía del Sistema
  </text>
  
  <!-- USB-C Entrada -->
  <g transform="translate(70, 605)">
    <rect x="0" y="0" width="90" height="60" rx="8" fill="url(#gradCarga)"/>
    <text x="45" y="25" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">USB-C</text>
    <text x="45" y="42" font-family="Consolas, monospace" font-size="10" fill="white" text-anchor="middle">5V 2A</text>
    <text x="45" y="55" font-family="Segoe UI, Arial" font-size="8" fill="rgba(255,255,255,0.8)" text-anchor="middle">(Carga)</text>
  </g>
  
  <!-- Flecha USB → IP5306 -->
  <path d="M165,635 L195,635" stroke="#e53e3e" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
  
  <!-- IP5306 -->
  <g transform="translate(205, 600)">
    <rect x="0" y="0" width="100" height="70" rx="8" fill="url(#gradBMS)"/>
    <text x="50" y="22" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">IP5306</text>
    <text x="50" y="40" font-family="Segoe UI, Arial" font-size="9" fill="white" text-anchor="middle">BMS 1S</text>
    <text x="50" y="55" font-family="Segoe UI, Arial" font-size="8" fill="rgba(255,255,255,0.8)" text-anchor="middle">Carga/Descarga</text>
  </g>
  
  <!-- Flecha IP5306 ↔ Batería -->
  <path d="M255,600 L255,580 L255,565" stroke="#38a169" stroke-width="2" fill="none"/>
  <path d="M260,600 L260,580 L260,565" stroke="#d69e2e" stroke-width="2" fill="none"/>
  
  <!-- Batería (arriba de IP5306) -->
  <g transform="translate(210, 545)">
    <rect x="0" y="0" width="90" height="35" rx="6" fill="url(#gradBateria)" stroke="#d69e2e" stroke-width="2"/>
    <rect x="90" y="8" width="6" height="18" rx="2" fill="#d69e2e"/>
    <text x="45" y="15" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#744210" text-anchor="middle">2× 18650</text>
    <text x="45" y="28" font-family="Consolas, monospace" font-size="8" fill="#744210" text-anchor="middle">3.7V 5200mAh</text>
  </g>
  
  <!-- Flecha IP5306 → Switch -->
  <path d="M310,635 L350,635" stroke="#38a169" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="330" y="625" font-family="Consolas, monospace" font-size="8" fill="#38a169" text-anchor="middle">3.7V</text>
  
  <!-- Switch ON/OFF -->
  <g transform="translate(360, 615)">
    <rect x="0" y="0" width="60" height="40" rx="6" fill="#e2e8f0" stroke="#718096" stroke-width="2"/>
    <text x="30" y="17" font-family="Segoe UI, Arial" font-size="9" fill="#4a5568" text-anchor="middle">Switch</text>
    <text x="30" y="32" font-family="Segoe UI, Arial" font-size="8" fill="#718096" text-anchor="middle">ON/OFF</text>
  </g>
  
  <!-- Flecha Switch → XL6009 -->
  <path d="M425,635 L460,635" stroke="#4a5568" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- XL6009 Boost -->
  <g transform="translate(470, 600)">
    <rect x="0" y="0" width="110" height="70" rx="8" fill="url(#gradBoost)"/>
    <text x="55" y="22" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">XL6009</text>
    <text x="55" y="40" font-family="Segoe UI, Arial" font-size="9" fill="white" text-anchor="middle">BOOST</text>
    <text x="55" y="55" font-family="Consolas, monospace" font-size="9" fill="white" text-anchor="middle">3.7V → 5V</text>
  </g>
  
  <!-- Flecha XL6009 → Rail 5V -->
  <path d="M585,635 L620,635" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="600" y="625" font-family="Consolas, monospace" font-size="8" fill="#3182ce" text-anchor="middle">5V</text>
  
  <!-- Rail 5V -->
  <g transform="translate(630, 605)">
    <rect x="0" y="0" width="70" height="60" rx="8" fill="#3182ce"/>
    <text x="35" y="25" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">RAIL</text>
    <text x="35" y="45" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="white" text-anchor="middle">5V</text>
  </g>
  
  <!-- Distribución desde Rail 5V -->
  <path d="M705,620 L740,620 L740,580 L780,580" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M705,635 L780,635" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <path d="M705,650 L740,650 L740,690 L780,690" stroke="#3182ce" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  
  <!-- Cargas -->
  <!-- ESP32 (con regulador 3.3V) -->
  <g transform="translate(790, 560)">
    <rect x="0" y="0" width="110" height="45" rx="6" fill="#bee3f8" stroke="#3182ce" stroke-width="1"/>
    <text x="55" y="18" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#2b6cb0" text-anchor="middle">ESP32</text>
    <text x="55" y="33" font-family="Consolas, monospace" font-size="8" fill="#2b6cb0" text-anchor="middle">5V→3.3V 150mA</text>
  </g>
  
  <!-- Nextion -->
  <g transform="translate(790, 615)">
    <rect x="0" y="0" width="110" height="45" rx="6" fill="#fef3c7" stroke="#d69e2e" stroke-width="1"/>
    <text x="55" y="18" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#744210" text-anchor="middle">Nextion 7"</text>
    <text x="55" y="33" font-family="Consolas, monospace" font-size="8" fill="#744210" text-anchor="middle">5V @ 400mA</text>
  </g>
  
  <!-- LM358 + CD4051 -->
  <g transform="translate(790, 670)">
    <rect x="0" y="0" width="110" height="45" rx="6" fill="#e9d8fd" stroke="#805ad5" stroke-width="1"/>
    <text x="55" y="18" font-family="Segoe UI, Arial" font-size="9" font-weight="bold" fill="#553c9a" text-anchor="middle">LM358+CD4051</text>
    <text x="55" y="33" font-family="Consolas, monospace" font-size="8" fill="#553c9a" text-anchor="middle">5V @ 2mA</text>
  </g>
  
  <!-- Autonomía calculada -->
  <g transform="translate(920, 590)">
    <rect x="0" y="0" width="120" height="90" rx="10" fill="#c6f6d5" stroke="#38a169" stroke-width="2"/>
    <text x="60" y="25" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">AUTONOMÍA</text>
    <line x1="10" y1="35" x2="110" y2="35" stroke="#38a169" stroke-width="1"/>
    <text x="60" y="55" font-family="Segoe UI, Arial" font-size="9" fill="#276749" text-anchor="middle">5200 mAh ÷ 620 mA</text>
    <text x="60" y="78" font-family="Consolas, monospace" font-size="16" font-weight="bold" fill="#276749" text-anchor="middle">≈ 7.1 h</text>
  </g>
  
  <!-- Nota de seguridad -->
  <g transform="translate(70, 695)">
    <rect x="0" y="0" width="350" height="25" rx="5" fill="#fed7d7" stroke="#e53e3e" stroke-width="1"/>
    <text x="175" y="16" font-family="Segoe UI, Arial" font-size="9" fill="#c53030" text-anchor="middle">
      ⚠ Protecciones: Fusible 1.5A + DW01 (cortocircuito 3A) + IP5306 (sobrecarga 4.2V)
    </text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- SECCIÓN NUEVA: SEGURIDAD MINI POWERBANK Y TASAS DE CARGA/DESCARGA -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <rect x="40" y="740" width="1020" height="340" rx="12" fill="white" stroke="#e53e3e" stroke-width="2" stroke-dasharray="6,3" filter="url(#shadow)"/>
  <rect x="40" y="740" width="1020" height="40" rx="12" fill="#e53e3e"/>
  <rect x="40" y="768" width="1020" height="12" fill="#e53e3e"/>
  <text x="550" y="768" font-family="Segoe UI, Arial" font-size="16" font-weight="bold" fill="white" text-anchor="middle">
    ⚠ SEGURIDAD DE MINI POWERBANK - TASAS DE CARGA Y DESCARGA
  </text>
  
  <!-- Columna izquierda: Tasas de carga -->
  <g transform="translate(60, 800)">
    <rect x="0" y="0" width="300" height="260" rx="8" fill="#fff5f5" stroke="#feb2b2" stroke-width="1"/>
    <text x="150" y="22" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#c53030" text-anchor="middle">
      TASAS DE CARGA - Samsung ICR18650-26J
    </text>
    <line x1="10" y1="32" x2="290" y2="32" stroke="#feb2b2" stroke-width="1"/>
    
    <!-- Límites del fabricante -->
    <text x="15" y="52" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#742a2a">Límite máximo Samsung:</text>
    <text x="15" y="68" font-family="Consolas, monospace" font-size="10" fill="#742a2a">• 2C = 5.2A por celda (NO recomendado)</text>
    <text x="15" y="84" font-family="Segoe UI, Arial" font-size="9" fill="#c53030">  → Reduce vida útil significativamente</text>
    
    <!-- Carga recomendada -->
    <text x="15" y="108" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749">Carga recomendada:</text>
    <text x="15" y="124" font-family="Consolas, monospace" font-size="10" fill="#276749">• 0.5C = 1.3A por celda (óptimo)</text>
    <text x="15" y="140" font-family="Segoe UI, Arial" font-size="9" fill="#38a169">  → Máxima longevidad (&gt;500 ciclos)</text>
    
    <!-- IP5306 carga a 2A -->
    <rect x="15" y="155" width="270" height="55" rx="6" fill="#c6f6d5" stroke="#38a169" stroke-width="1"/>
    <text x="150" y="175" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">✓ IP5306 carga a 2A total:</text>
    <text x="150" y="195" font-family="Consolas, monospace" font-size="10" fill="#276749" text-anchor="middle">2A ÷ 2 celdas = 1A/celda = 0.38C</text>
    
    <!-- Margen de seguridad -->
    <rect x="15" y="220" width="270" height="30" rx="4" fill="#fef3c7" stroke="#d69e2e" stroke-width="1"/>
    <text x="150" y="240" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210" text-anchor="middle">
      Margen: 0.38C vs 2C = 5.3× bajo el límite ✓
    </text>
  </g>
  
  <!-- Columna central: Tasas de descarga -->
  <g transform="translate(380, 800)">
    <rect x="0" y="0" width="300" height="260" rx="8" fill="#fffaf0" stroke="#fbd38d" stroke-width="1"/>
    <text x="150" y="22" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#744210" text-anchor="middle">
      TASAS DE DESCARGA - Sistema
    </text>
    <line x1="10" y1="32" x2="290" y2="32" stroke="#fbd38d" stroke-width="1"/>
    
    <!-- Límites del fabricante -->
    <text x="15" y="52" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#742a2a">Límite máximo Samsung:</text>
    <text x="15" y="68" font-family="Consolas, monospace" font-size="10" fill="#742a2a">• 2C continuo = 5.2A por celda</text>
    <text x="15" y="84" font-family="Consolas, monospace" font-size="10" fill="#742a2a">• 4C pico = 10.4A (NO usar)</text>
    
    <!-- Consumo del sistema -->
    <text x="15" y="108" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749">Consumo real del sistema:</text>
    <text x="15" y="124" font-family="Consolas, monospace" font-size="10" fill="#276749">• Total: ~620 mA típico @ 5V</text>
    <text x="15" y="140" font-family="Consolas, monospace" font-size="10" fill="#276749">• Desde batería: ~840 mA @ 3.7V</text>
    
    <!-- Cálculo por celda -->
    <rect x="15" y="155" width="270" height="55" rx="6" fill="#c6f6d5" stroke="#38a169" stroke-width="1"/>
    <text x="150" y="175" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">✓ Corriente por celda:</text>
    <text x="150" y="195" font-family="Consolas, monospace" font-size="10" fill="#276749" text-anchor="middle">840mA ÷ 2 celdas = 420mA = 0.16C</text>
    
    <!-- Margen de seguridad -->
    <rect x="15" y="220" width="270" height="30" rx="4" fill="#fef3c7" stroke="#d69e2e" stroke-width="1"/>
    <text x="150" y="240" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#744210" text-anchor="middle">
      Margen: 0.16C vs 2C = 12.5× bajo el límite ✓
    </text>
  </g>
  
  <!-- Columna derecha: Precauciones mini powerbank -->
  <g transform="translate(700, 800)">
    <rect x="0" y="0" width="340" height="260" rx="8" fill="#fff5f5" stroke="#fc8181" stroke-width="2"/>
    <text x="170" y="22" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="#c53030" text-anchor="middle">
      ⚠ PRECAUCIONES MINI POWERBANK
    </text>
    <line x1="10" y1="32" x2="330" y2="32" stroke="#fc8181" stroke-width="1"/>
    
    <!-- Lista de precauciones -->
    <text x="15" y="52" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • Usar celdas con ≤0.05V de diferencia antes de conectar
    </text>
    <text x="15" y="68" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • Mismo lote, modelo y capacidad (Samsung 26J)
    </text>
    <text x="15" y="84" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • BMS obligatorio (IP5306 incluye protección)
    </text>
    <text x="15" y="100" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • Cables AWG18 o mayores entre celdas
    </text>
    <text x="15" y="116" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • Verificar autenticidad Samsung (peso ~45g)
    </text>
    <text x="15" y="132" font-family="Segoe UI, Arial" font-size="9" fill="#742a2a">
      • Ventilación en carcasa para disipación térmica
    </text>
    
    <!-- Resumen protecciones IP5306 -->
    <rect x="15" y="145" width="310" height="105" rx="6" fill="#c6f6d5" stroke="#38a169" stroke-width="1"/>
    <text x="170" y="165" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#276749" text-anchor="middle">
      PROTECCIONES INTEGRADAS IP5306:
    </text>
    <text x="25" y="185" font-family="Segoe UI, Arial" font-size="9" fill="#276749">✓ Sobrecarga: Corte automático a 4.2V ±0.5%</text>
    <text x="25" y="201" font-family="Segoe UI, Arial" font-size="9" fill="#276749">✓ Sobredescarga: Corte a 2.9V (BMS adicional a 2.5V)</text>
    <text x="25" y="217" font-family="Segoe UI, Arial" font-size="9" fill="#276749">✓ Perfil CC/CV correcto para Li-ion</text>
    <text x="25" y="233" font-family="Segoe UI, Arial" font-size="9" fill="#276749">✓ Terminación de carga: I &lt; 100mA</text>
  </g>
</svg>
