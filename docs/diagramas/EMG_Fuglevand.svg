<svg xmlns="http://www.w3.org/2000/svg" width="600" height="900" viewBox="0 0 600 900">
  <style>
    .title { font: bold 18px Arial; }
    .subtitle { font: 13px Arial; fill: #666; }
    .box-text { font: 10px Arial; }
    .box-bold { font: bold 10px Arial; }
    .box-code { font: 9px Courier New; }
    .label { font: bold 9px Arial; fill: #c00; }
  </style>
  
  <rect width="100%" height="100%" fill="white"/>
  
  <text x="300" y="30" text-anchor="middle" class="title">EMG – Modelo estocástico Fuglevand 1993</text>
  <text x="300" y="48" text-anchor="middle" class="subtitle">Flujo de generación de señal electromiográfica</text>
  
  <!-- deltaTime -->
  <rect x="225" y="65" width="150" height="28" rx="4" fill="#d5d5d5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="84" text-anchor="middle" class="box-bold">deltaTime</text>
  <path d="M300 93 L300 108 L296 103 M300 108 L304 103" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- tick -->
  <rect x="200" y="113" width="200" height="28" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="132" text-anchor="middle" class="box-bold">tick(deltaTime)</text>
  <path d="M300 141 L300 156 L296 151 M300 156 L304 151" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Condición -->
  <rect x="140" y="161" width="320" height="28" rx="3" fill="#f5f5f5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="180" text-anchor="middle" class="box-text">Condición EMG: reposo, contracción, temblor, fatiga</text>
  <path d="M300 189 L300 204 L296 199 M300 204 L304 199" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- accumulatedTime -->
  <rect x="175" y="209" width="250" height="26" rx="3" fill="#f5f5f5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="227" text-anchor="middle" class="box-text">accumulatedTime += deltaTime</text>
  <path d="M300 235 L300 250 L296 245 M300 250 L304 245" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Decision rampa -->
  <rect x="165" y="255" width="270" height="26" rx="3" fill="#fff3cd" stroke="#b8860b" stroke-width="1.5"/>
  <text x="300" y="273" text-anchor="middle" class="box-text">¿Rampa de excitación activa?</text>
  <text x="315" y="297" class="label">SÍ</text>
  <path d="M300 281 L300 301 L296 296 M300 301 L304 296" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- lerp -->
  <rect x="175" y="306" width="250" height="26" rx="3" fill="#e0e0e0" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="324" text-anchor="middle" class="box-code">E = lerp(base, target, t/T)</text>
  <path d="M300 332 L300 347 L296 342 M300 347 L304 342" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- updateMotorUnit -->
  <rect x="120" y="352" width="360" height="68" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="370" text-anchor="middle" class="box-bold">updateMotorUnitRecruitment()</text>
  <text x="300" y="390" text-anchor="middle" class="box-code">FRᵢ = FR_min + (FR_max − FR_min) × (E − thresholdᵢ)</text>
  <text x="300" y="410" text-anchor="middle" style="font:8px Arial;fill:#666">Principio de Henneman: recluta primero MUs pequeñas (tipo I), luego grandes (tipo II)</text>
  <path d="M300 420 L300 435 L296 430 M300 435 L304 430" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- generateMUAP -->
  <rect x="155" y="440" width="290" height="42" rx="3" fill="#f5f5f5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="458" text-anchor="middle" class="box-bold">generateMUAP()</text>
  <text x="300" y="475" text-anchor="middle" class="box-text">Forma trifásica, superposición de MUs activas</text>
  <path d="M300 482 L300 497 L296 492 M300 497 L304 492" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Modificadores -->
  <rect x="145" y="502" width="310" height="42" rx="3" fill="#f5f5f5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="520" text-anchor="middle" class="box-bold">Modificadores</text>
  <text x="300" y="537" text-anchor="middle" class="box-text">Temblor: modulación sinusoidal 5 Hz  •  Fatiga: decay exponencial</text>
  <path d="M300 544 L300 559 L296 554 M300 559 L304 554" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Noise -->
  <rect x="175" y="564" width="250" height="26" rx="3" fill="#f5f5f5" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="582" text-anchor="middle" class="box-text">sample += noise × gaussian()</text>
  <path d="M300 590 L300 605 L296 600 M300 605 L304 600" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Output range -->
  <rect x="175" y="610" width="250" height="28" rx="3" fill="#d4edda" stroke="#198754" stroke-width="1.5"/>
  <text x="300" y="629" text-anchor="middle" class="box-bold">Rango fisiológico: −5.0 a +5.0 mV</text>
  <path d="M300 638 L300 653 L296 648 M300 653 L304 648" stroke="#333" stroke-width="1.5" fill="none"/>
  
  <!-- Envolvente -->
  <rect x="130" y="658" width="340" height="48" rx="3" fill="#e0e0e0" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="676" text-anchor="middle" class="box-bold">Procesamiento canal envolvente:</text>
  <text x="300" y="696" text-anchor="middle" class="box-text">Filtro BP (20-450Hz) → Rectificación |x| → LPF (15Hz)</text>
  
  <line x1="200" y1="706" x2="130" y2="740" stroke="#333" stroke-width="1.5"/>
  <line x1="300" y1="706" x2="300" y2="740" stroke="#333" stroke-width="1.5"/>
  <line x1="400" y1="706" x2="470" y2="740" stroke="#333" stroke-width="1.5"/>
  
  <!-- getDACValue -->
  <rect x="50" y="745" width="160" height="80" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="130" y="763" text-anchor="middle" class="box-bold">getDACValue()</text>
  <text x="130" y="780" text-anchor="middle" class="box-text">→ 0-255 → 0-3.3V</text>
  <text x="130" y="800" text-anchor="middle" class="box-code">DAC = (mV+5)/10 × 255</text>
  <text x="130" y="817" text-anchor="middle" style="font:8px Arial;fill:#666">Ej: +2.5mV → 191 → 2.47V</text>
  
  <!-- getWaveformValue -->
  <rect x="220" y="745" width="160" height="80" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="300" y="763" text-anchor="middle" class="box-bold">getWaveformValue()</text>
  <text x="300" y="780" text-anchor="middle" class="box-text">→ Nextion (RAW)</text>
  <text x="300" y="800" text-anchor="middle" class="box-text">Canal 0</text>
  
  <!-- getEnvelopeWaveformValue -->
  <rect x="390" y="745" width="160" height="80" rx="3" fill="#e8e8e8" stroke="#333" stroke-width="1.5"/>
  <text x="470" y="760" text-anchor="middle" class="box-bold">getEnvelope</text>
  <text x="470" y="775" text-anchor="middle" class="box-bold">WaveformValue()</text>
  <text x="470" y="795" text-anchor="middle" class="box-text">→ Nextion (ENV)</text>
  <text x="470" y="815" text-anchor="middle" class="box-text">Rango: 0-2.0 mV</text>
  
  <text x="300" y="860" text-anchor="middle" style="font:9px Arial;fill:#999">BioSimulator Pro v1.0.0</text>
</svg>
