<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 650">
  <defs>
    <style>
      .box { fill: #e8eaf6; stroke: #3f51b5; stroke-width: 2; }
      .title { fill: #1a237e; font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .text { fill: #424242; font-family: Arial, sans-serif; font-size: 12px; }
      .arrow { stroke: #3f51b5; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .label { fill: #3f51b5; font-family: Arial, sans-serif; font-size: 11px; font-style: italic; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3f51b5" />
    </marker>
  </defs>
  
  <!-- Título -->
  <text x="400" y="30" text-anchor="middle" style="font-size: 18px; font-weight: bold; fill: #1a237e;">
    Flujo de Programación - App Web
  </text>
  
  <!-- ESP32 WiFi AP -->
  <rect x="50" y="60" width="200" height="100" class="box" rx="5"/>
  <text x="150" y="85" text-anchor="middle" class="title">ESP32 WiFi AP</text>
  <text x="150" y="105" text-anchor="middle" class="text">SSID: BioSignalSimulator_Pro</text>
  <text x="150" y="125" text-anchor="middle" class="text">IP: 192.168.4.1</text>
  <text x="150" y="145" text-anchor="middle" class="text">Clientes: 4 máx</text>
  
  <!-- Web Server -->
  <rect x="300" y="60" width="200" height="100" class="box" rx="5"/>
  <text x="400" y="85" text-anchor="middle" class="title">ESPAsyncWebServer</text>
  <text x="400" y="105" text-anchor="middle" class="text">Puerto 80 (HTTP)</text>
  <text x="400" y="125" text-anchor="middle" class="text">SPIFFS: app.html, app.js</text>
  <text x="400" y="145" text-anchor="middle" class="text">Buffer: 128 KB</text>
  
  <!-- Browser Client -->
  <rect x="550" y="60" width="200" height="100" class="box" rx="5"/>
  <text x="650" y="85" text-anchor="middle" class="title">Navegador Cliente</text>
  <text x="650" y="105" text-anchor="middle" class="text">Chrome/Firefox/Safari</text>
  <text x="650" y="125" text-anchor="middle" class="text">Móvil/Tablet/Desktop</text>
  <text x="650" y="145" text-anchor="middle" class="text">Responsive Design</text>
  
  <!-- Arrows -->
  <path d="M 250 110 L 300 110" class="arrow"/>
  <text x="275" y="105" text-anchor="middle" class="label">WiFi</text>
  
  <path d="M 500 110 L 550 110" class="arrow"/>
  <text x="525" y="105" text-anchor="middle" class="label">HTTP GET</text>
  
  <!-- WebSocket Layer -->
  <rect x="50" y="200" width="700" height="80" class="box" rx="5"/>
  <text x="400" y="225" text-anchor="middle" class="title">WebSocket (Puerto 81)</text>
  <text x="400" y="245" text-anchor="middle" class="text">Comunicación bidireccional en tiempo real</text>
  <text x="400" y="265" text-anchor="middle" class="text">Protocolo: JSON | Frecuencia: 100 Hz (datos) + 4 Hz (métricas)</text>
  
  <!-- Vertical arrows -->
  <path d="M 150 160 L 150 200" class="arrow"/>
  <path d="M 400 160 L 400 200" class="arrow"/>
  <path d="M 650 160 L 650 200" class="arrow"/>
  
  <!-- Signal Engine -->
  <rect x="50" y="320" width="200" height="80" class="box" rx="5"/>
  <text x="150" y="345" text-anchor="middle" class="title">Signal Engine (Core 1)</text>
  <text x="150" y="365" text-anchor="middle" class="text">Timer ISR @ 2000 Hz</text>
  <text x="150" y="385" text-anchor="middle" class="text">ECG/EMG/PPG Models</text>
  
  <!-- JSON Encoder -->
  <rect x="300" y="320" width="200" height="80" class="box" rx="5"/>
  <text x="400" y="345" text-anchor="middle" class="title">JSON Encoder</text>
  <text x="400" y="365" text-anchor="middle" class="text">Formato compacto</text>
  <text x="400" y="385" text-anchor="middle" class="text">~95 bytes/mensaje</text>
  
  <!-- Chart.js Renderer -->
  <rect x="550" y="320" width="200" height="80" class="box" rx="5"/>
  <text x="650" y="345" text-anchor="middle" class="title">Chart.js Renderer</text>
  <text x="650" y="365" text-anchor="middle" class="text">Canvas API @ 60 fps</text>
  <text x="650" y="385" text-anchor="middle" class="text">Buffer circular 500 pts</text>
  
  <!-- Arrows between layers -->
  <path d="M 150 280 L 150 320" class="arrow"/>
  <text x="170" y="305" text-anchor="start" class="label">Muestras</text>
  
  <path d="M 250 360 L 300 360" class="arrow"/>
  <text x="275" y="355" text-anchor="middle" class="label">Encode</text>
  
  <path d="M 400 280 L 400 320" class="arrow"/>
  <text x="420" y="305" text-anchor="start" class="label">WebSocket</text>
  
  <path d="M 500 360 L 550 360" class="arrow"/>
  <text x="525" y="355" text-anchor="middle" class="label">JSON</text>
  
  <path d="M 650 280 L 650 320" class="arrow"/>
  <text x="670" y="305" text-anchor="start" class="label">Render</text>
  
  <!-- JSON Message Format -->
  <rect x="50" y="440" width="340" height="180" style="fill: #fff9c4; stroke: #f57f17; stroke-width: 1.5;" rx="5"/>
  <text x="220" y="465" text-anchor="middle" style="font-size: 12px; font-weight: bold; fill: #f57f17;">Formato JSON - Datos (100 Hz)</text>
  
  <text x="70" y="490" style="font-size: 11px; font-family: monospace; fill: #424242;">{</text>
  <text x="90" y="510" style="font-size: 11px; font-family: monospace; fill: #424242;">"type": "signal",</text>
  <text x="90" y="530" style="font-size: 11px; font-family: monospace; fill: #424242;">"signalType": "ECG",</text>
  <text x="90" y="550" style="font-size: 11px; font-family: monospace; fill: #424242;">"value": 1.23,</text>
  <text x="90" y="570" style="font-size: 11px; font-family: monospace; fill: #424242;">"envelope": 0.0,</text>
  <text x="90" y="590" style="font-size: 11px; font-family: monospace; fill: #424242;">"dac": 185,</text>
  <text x="90" y="610" style="font-size: 11px; font-family: monospace; fill: #424242;">"timestamp": 12345</text>
  <text x="70" y="630" style="font-size: 11px; font-family: monospace; fill: #424242;">}</text>
  
  <!-- Metrics Format -->
  <rect x="410" y="440" width="340" height="180" style="fill: #e1f5fe; stroke: #0277bd; stroke-width: 1.5;" rx="5"/>
  <text x="580" y="465" text-anchor="middle" style="font-size: 12px; font-weight: bold; fill: #0277bd;">Formato JSON - Métricas (4 Hz)</text>
  
  <text x="430" y="490" style="font-size: 11px; font-family: monospace; fill: #424242;">{</text>
  <text x="450" y="510" style="font-size: 11px; font-family: monospace; fill: #424242;">"type": "metrics",</text>
  <text x="450" y="530" style="font-size: 11px; font-family: monospace; fill: #424242;">"hr": 75,</text>
  <text x="450" y="550" style="font-size: 11px; font-family: monospace; fill: #424242;">"rr": 800,</text>
  <text x="450" y="570" style="font-size: 11px; font-family: monospace; fill: #424242;">"qrs": 1.2,</text>
  <text x="450" y="590" style="font-size: 11px; font-family: monospace; fill: #424242;">"st": 0.05,</text>
  <text x="450" y="610" style="font-size: 11px; font-family: monospace; fill: #424242;">"hrv": 1.0</text>
  <text x="430" y="630" style="font-size: 11px; font-family: monospace; fill: #424242;">}</text>
  
  <!-- Footer -->
  <text x="400" y="655" text-anchor="middle" style="font-size: 10px; fill: #757575;">
    Throughput: ~9.5 KB/s | Latencia: &lt;50 ms | Reconexión automática
  </text>
</svg>
