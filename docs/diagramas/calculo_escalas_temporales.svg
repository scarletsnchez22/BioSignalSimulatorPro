<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700" width="1000" height="700">
  <defs>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
  </defs>
  
  <!-- Fondo -->
  <rect width="1000" height="700" fill="#fafafa"/>
  
  <!-- Título -->
  <text x="500" y="35" font-family="Segoe UI, Arial" font-size="22" font-weight="bold" fill="#333" text-anchor="middle">
    Cálculo de Escalas Temporales - Waveform Nextion
  </text>
  <text x="500" y="58" font-family="Segoe UI, Arial" font-size="13" fill="#666" text-anchor="middle">
    BioSignalSimulator Pro | Sin interpolación | Rolling Display 700×380 px
  </text>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- FÓRMULA DE CÁLCULO - PARTE SUPERIOR -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 85)">
    <rect x="0" y="0" width="920" height="130" rx="8" fill="white" stroke="#3498db" stroke-width="2" filter="url(#shadow)"/>
    
    <!-- Header -->
    <rect x="0" y="0" width="920" height="32" rx="8" fill="#3498db"/>
    <rect x="0" y="20" width="920" height="12" fill="#3498db"/>
    <text x="460" y="22" font-family="Segoe UI, Arial" font-size="13" font-weight="bold" fill="white" text-anchor="middle">
      FÓRMULA DE CÁLCULO (envío directo, sin interpolación)
    </text>
    
    <!-- Fórmulas principales -->
    <text x="50" y="65" font-family="Segoe UI, Arial" font-size="14" fill="#333">
      <tspan font-weight="bold">1. Puntos enviados por segundo:</tspan>
    </text>
    <text x="350" y="65" font-family="Consolas, monospace" font-size="14" fill="#2980b9">
      Puntos/s = Fs_display (1 muestra = 1 punto Nextion)
    </text>
    
    <text x="50" y="95" font-family="Segoe UI, Arial" font-size="14" fill="#333">
      <tspan font-weight="bold">2. Tiempo por división:</tspan>
    </text>
    <text x="350" y="95" font-family="Consolas, monospace" font-size="14" fill="#2980b9">
      ms/div = (px_por_div / Puntos_por_s) × 1000 = (70 / Fs_display) × 1000
    </text>
    
    <text x="50" y="120" font-family="Segoe UI, Arial" font-size="14" fill="#333">
      <tspan font-weight="bold">3. Tiempo total pantalla:</tspan>
    </text>
    <text x="350" y="120" font-family="Consolas, monospace" font-size="14" fill="#2980b9">
      T_pantalla = 10 divisiones × ms/div
    </text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- TABLA DE CÁLCULOS POR SEÑAL -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 235)">
    <rect x="0" y="0" width="920" height="210" rx="8" fill="white" stroke="#555" stroke-width="1.2" filter="url(#shadow)"/>
    
    <!-- Header tabla -->
    <rect x="0" y="0" width="920" height="32" rx="8" fill="#333"/>
    <rect x="0" y="20" width="920" height="12" fill="#333"/>
    <text x="460" y="22" font-family="Segoe UI, Arial" font-size="13" font-weight="bold" fill="white" text-anchor="middle">
      TABLA DE ESCALAS TEMPORALES (Sin Interpolación)
    </text>
    
    <!-- Subheaders -->
    <rect x="0" y="32" width="920" height="28" fill="#f5f5f5"/>
    <text x="60" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">Señal</text>
    <text x="180" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">Fs_display</text>
    <text x="300" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">Puntos/s</text>
    <text x="420" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">px/div</text>
    <text x="540" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">ms/div</text>
    <text x="680" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">T_pantalla</text>
    <text x="820" y="51" font-family="Segoe UI, Arial" font-size="10" font-weight="bold" fill="#333" text-anchor="middle">Latidos/Ciclos visibles</text>
    
    <!-- ECG Row -->
    <rect x="10" y="70" width="100" height="40" rx="4" fill="#2ecc71"/>
    <text x="60" y="95" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">ECG</text>
    <text x="180" y="95" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">200 Hz</text>
    <text x="300" y="95" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#27ae60" text-anchor="middle">200</text>
    <text x="420" y="95" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">70</text>
    <text x="540" y="95" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#8e44ad" text-anchor="middle">350</text>
    <text x="680" y="95" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#333" text-anchor="middle">3.5 s</text>
    <text x="820" y="95" font-family="Segoe UI, Arial" font-size="10" fill="#666" text-anchor="middle">2-6 latidos (@60-100 BPM)</text>
    
    <!-- EMG Row -->
    <rect x="10" y="120" width="100" height="40" rx="4" fill="#e67e22"/>
    <text x="60" y="145" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">EMG</text>
    <text x="180" y="145" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">100 Hz</text>
    <text x="300" y="145" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#d35400" text-anchor="middle">100</text>
    <text x="420" y="145" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">70</text>
    <text x="540" y="145" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#8e44ad" text-anchor="middle">700</text>
    <text x="680" y="145" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#333" text-anchor="middle">7.0 s</text>
    <text x="820" y="145" font-family="Segoe UI, Arial" font-size="10" fill="#666" text-anchor="middle">~1.75 ciclos 4s (REST→CONTR)</text>
    
    <!-- PPG Row -->
    <rect x="10" y="170" width="100" height="40" rx="4" fill="#3498db"/>
    <text x="60" y="195" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">PPG</text>
    <text x="180" y="195" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">100 Hz</text>
    <text x="300" y="195" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#2980b9" text-anchor="middle">100</text>
    <text x="420" y="195" font-family="Consolas, monospace" font-size="11" fill="#333" text-anchor="middle">70</text>
    <text x="540" y="195" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#8e44ad" text-anchor="middle">700</text>
    <text x="680" y="195" font-family="Consolas, monospace" font-size="11" font-weight="bold" fill="#333" text-anchor="middle">7.0 s</text>
    <text x="820" y="195" font-family="Segoe UI, Arial" font-size="10" fill="#666" text-anchor="middle">7-12 pulsos (@60-100 BPM)</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- EJEMPLOS DE CÁLCULO DETALLADO -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 465)">
    <!-- ECG -->
    <rect x="0" y="0" width="450" height="120" rx="8" fill="#e8f6f3" stroke="#27ae60" stroke-width="1.5" filter="url(#shadow)"/>
    <rect x="0" y="0" width="450" height="28" rx="8" fill="#27ae60"/>
    <rect x="0" y="16" width="450" height="12" fill="#27ae60"/>
    <text x="225" y="20" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">
      EJEMPLO: CÁLCULO ECG
    </text>
    
    <text x="20" y="50" font-family="Consolas, monospace" font-size="10" fill="#333">Fs_display = 200 Hz</text>
    <text x="20" y="65" font-family="Consolas, monospace" font-size="10" fill="#333">Sin interpolación (1:1)</text>
    <text x="20" y="85" font-family="Consolas, monospace" font-size="10" fill="#27ae60" font-weight="bold">Puntos/s = 200 pts/s</text>
    <text x="20" y="105" font-family="Consolas, monospace" font-size="10" fill="#8e44ad" font-weight="bold">ms/div = (70 / 200) × 1000 = 350 ms/div</text>
    <text x="20" y="115" font-family="Consolas, monospace" font-size="9" fill="#666">T_pantalla = 10 × 350 = 3500 ms = 3.5 s</text>
  </g>
  
  <g transform="translate(510, 465)">
    <!-- EMG/PPG -->
    <rect x="0" y="0" width="450" height="120" rx="8" fill="#fdf2e9" stroke="#e67e22" stroke-width="1.5" filter="url(#shadow)"/>
    <rect x="0" y="0" width="450" height="28" rx="8" fill="#e67e22"/>
    <rect x="0" y="16" width="450" height="12" fill="#e67e22"/>
    <text x="225" y="20" font-family="Segoe UI, Arial" font-size="12" font-weight="bold" fill="white" text-anchor="middle">
      EJEMPLO: CÁLCULO EMG/PPG
    </text>
    
    <text x="20" y="50" font-family="Consolas, monospace" font-size="10" fill="#333">Fs_display = 100 Hz</text>
    <text x="20" y="65" font-family="Consolas, monospace" font-size="10" fill="#333">Sin interpolación (1:1)</text>
    <text x="20" y="85" font-family="Consolas, monospace" font-size="10" fill="#d35400" font-weight="bold">Puntos/s = 100 pts/s</text>
    <text x="20" y="105" font-family="Consolas, monospace" font-size="10" fill="#8e44ad" font-weight="bold">ms/div = (70 / 100) × 1000 = 700 ms/div</text>
    <text x="20" y="115" font-family="Consolas, monospace" font-size="9" fill="#666">T_pantalla = 10 × 700 = 7000 ms = 7.0 s</text>
  </g>
  
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!-- NOTAS Y JUSTIFICACIÓN -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <g transform="translate(40, 600)">
    <rect x="0" y="0" width="920" height="80" rx="8" fill="#f8f9fa" stroke="#adb5bd" stroke-width="1" filter="url(#shadow)"/>
    <rect x="0" y="0" width="920" height="24" rx="8" fill="#6c757d"/>
    <rect x="0" y="14" width="920" height="10" fill="#6c757d"/>
    <text x="460" y="17" font-family="Segoe UI, Arial" font-size="11" font-weight="bold" fill="white" text-anchor="middle">
      NOTAS Y JUSTIFICACIÓN
    </text>
    
    <text x="20" y="45" font-family="Segoe UI, Arial" font-size="10" fill="#333">
      • <tspan font-weight="bold">Sin interpolación:</tspan> Cada muestra del modelo se envía directamente a Nextion (1 muestra = 1 punto = 1 píxel de avance).
    </text>
    <text x="20" y="60" font-family="Segoe UI, Arial" font-size="10" fill="#333">
      • <tspan font-weight="bold">Mayor ventana temporal:</tspan> ECG muestra 3.5s (2-6 latidos), EMG/PPG muestran 7s completos para observar patrones.
    </text>
    <text x="20" y="75" font-family="Segoe UI, Arial" font-size="10" fill="#333">
      • <tspan font-weight="bold">EMG ciclo 4s:</tspan> Ventana de 7s muestra casi 2 ciclos completos REST(1s)→CONTRACCIÓN(3s), ideal para comparar.
    </text>
  </g>
  
  <!-- Referencia -->
  <text x="500" y="695" font-family="Segoe UI, Arial" font-size="9" fill="#888" text-anchor="middle">
    Fuente: main.cpp (updateDisplay), METODOLOGIA_COMPUTACIONAL.md (Tabla 9.5)
  </text>
</svg>
